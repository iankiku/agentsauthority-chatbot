/**
 * Agent Network Configuration
 *
 * This file sets up the hierarchical agent network using Mastra's vNext AgentNetwork.
 * The network includes planning, supervision, review, and specialist agents.
 */
import { NewAgentNetwork } from "@mastra/core/network/vNext";
// import { Memory } from "@mastra/memory";
import { getModel } from "../config/agent-config";

// Import hierarchical agents
import { Agent } from "@mastra/core/agent"; // Ensure correct Agent import
import { planningAgents } from "../agents/planners";
import { reviewAgents } from "../agents/reviewers";
import { supervisorAgents } from "../agents/supervisors";

// Import specialist agents
import { codeWriterAgent, qaAgent } from "../agents/codeWriterAgent";
import { geoOrchestratorAgent } from "../agents/geoOrchestratorAgent";
import {
	aiCopywriterAgent,
	aiReadinessAgent,
	brandMonitorAgent,
	contentClusterAgent,
	promptSimulatorAgent,
	promptTrendAgent,
	staticRenderAgent,
	topicalDepthAgent,
} from "../agents/geoSuiteAgents";
import { roastMyWebsiteAgent } from "../agents/roastMyWebsiteAgent";
import { weatherAgent } from "../agents/weather-agent";

// Import workflows
// import { geoAnalysisWorkflow } from "../workflows/geoAnalysisWorkflow";
import { roastWorkflow } from "../workflows/roastWorkflow";

/**
 * Initialize shared memory for the network
 * This is crucial for the vNext implementation as it stores task history
 * and enables the network to make routing decisions
 */
// const networkMemory = new Memory({
// 	storage: new LibSQLStore({
// 		url: process.env.TURSO_URL || "file:../agent-network.db",
// 	}),
// });

/**
 * Hierarchical Agent Network
 *
 * This network implements a hierarchical structure where:
 * - Planning agents analyze tasks and create execution plans
 * - Supervisor agents orchestrate execution and manage resources
 * - Review agents validate outputs and ensure quality
 * - Specialist agents perform specific domain tasks
 *
 * The network uses Mastra's vNext AgentNetwork for intelligent routing
 * and dynamic task coordination.
 */
export const hierarchicalAgentNetwork = new NewAgentNetwork({
	id: "hierarchical-agent-network",
	name: "Hierarchical Agent Network",
	instructions: `
		You are the master coordinator of a hierarchical agent network designed for comprehensive task execution.
		
		This network includes:
		
		**Planning Layer:**
		- Master Planner: Analyzes requests and creates structured task plans
		- Task Specialist Planner: Provides domain-specific planning expertise
		- Adaptive Planner: Handles dynamic replanning and optimization
		
		**Supervision Layer:**
		- Master Supervisor: Orchestrates multi-agent workflows
		- Task Execution Supervisor: Manages detailed task execution
		- Quality Supervisor: Enforces quality standards
		- Emergency Response Supervisor: Handles critical situations
		
		**Review Layer:**
		- Master Review Agent: Coordinates comprehensive reviews
		- Quality Assurance Agent: Ensures quality standards
		- Technical Review Agent: Validates technical implementations
		- Content Review Agent: Reviews content quality and accuracy
		
		**Specialist Layer:**
		- GEO Suite: Complete Generative Engine Optimization capabilities
		- Code Writer: Software development and analysis
		- Weather Agent: Weather information and forecasts
		- Roast Website: Humorous website critique
		
		**Execution Flow:**
		1. Planning agents analyze user requests and create detailed plans
		2. Supervisor agents coordinate execution across specialist agents
		3. Specialist agents perform domain-specific tasks
		4. Review agents validate outputs and ensure quality
		5. Supervisor agents handle any issues or iterations needed
		
		**Quality Assurance:**
		- All specialist agent outputs are reviewed before completion
		- Quality standards are enforced throughout the process
		- Failed tasks are replanned and re-executed as needed
		
		Always route tasks through the appropriate planning → supervision → execution → review cycle.
	`,
	model: getModel("qwen"),
	agents: {
		// Planning agents
		masterPlanner: planningAgents.plannerAgent as any,
		taskSpecialistPlanner: 
			planningAgents.taskSpecialistPlannerAgent as any,
		adaptivePlanner: planningAgents.adaptivePlannerAgent as any,

		// Supervisor agents
		masterSupervisor: supervisorAgents.supervisorAgent as any,
		taskExecutionSupervisor: 
			supervisorAgents.taskExecutionSupervisorAgent as any,
		qualitySupervisor: 
			supervisorAgents.qualitySupervisorAgent as any,
		emergencyResponseSupervisor: 
			supervisorAgents.emergencyResponseSupervisorAgent as any,

		// Review agents
		masterReviewer: reviewAgents.reviewAgent as any,
		qualityAssuranceAgent: reviewAgents.qualityAssuranceAgent as any,
		technicalReviewAgent: reviewAgents.technicalReviewAgent as any,
		contentReviewAgent: reviewAgents.contentReviewAgent as any,

		// GEO Suite specialists
		geoOrchestrator: geoOrchestratorAgent as any,
		contentClusterSpecialist: contentClusterAgent as any,
		brandMonitor: brandMonitorAgent as any,
		topicalDepthAnalyzer: topicalDepthAgent as any,
		promptSimulator: promptSimulatorAgent as any,
		staticRenderSpecialist: staticRenderAgent as any,
		aiCopywriter: aiCopywriterAgent as any,
		promptTrendAnalyst: promptTrendAgent as any,
		aiReadinessEvaluator: aiReadinessAgent as any,

		// General specialists
		codeWriter: codeWriterAgent as any,
		qualityAssuranceInspector: qaAgent as any,
		weatherSpecialist: weatherAgent as any,
		websiteRoaster: roastMyWebsiteAgent as any,
	},
	workflows: {
		geoAnalysisWorkflow: geoAnalysisWorkflow as any,
		roastWorkflow: roastWorkflow as any,
	},
	// memory: networkMemory,
});

/**
 * GEO-Focused Agent Network
 *
 * A specialized network focused specifically on Generative Engine Optimization tasks.
 * This network is optimized for GEO analysis, content optimization, and AI readiness evaluation.
 */
export const geoAgentNetwork = new NewAgentNetwork({
	id: "geo-agent-network",
	name: "GEO Agent Network",
	instructions: `
		You are a specialized coordinator for Generative Engine Optimization (GEO) tasks.
		
		This network specializes in:
		- Website analysis and optimization for AI-powered search
		- Content strategy for generative AI platforms
		- Brand monitoring in AI-generated content
		- Technical optimization for AI crawlers
		
		**Available Specialists:**
		- GEO Orchestrator: Master coordinator for comprehensive GEO analysis
		- Content Cluster Specialist: Semantic keyword clustering and content mapping
		- Brand Monitor: Brand mention tracking with AI content detection
		- Topical Depth Analyzer: Content depth and expertise evaluation
		- Prompt Simulator: AI prompt testing and optimization
		- Static Render Specialist: Pre-rendering for AI crawlers
		- AI Copywriter: High-quality content generation
		- Prompt Trend Analyst: AI prompt trend analysis
		- AI Readiness Evaluator: Comprehensive AI readiness assessment
		
		For any GEO-related request, route through the appropriate specialists
		and ensure comprehensive analysis covering all relevant aspects.
	`,
	model: getModel("qwen"),
	agents: {
		// GEO Suite with hierarchical support
		masterPlanner: planningAgents.plannerAgent as any,
		masterSupervisor: supervisorAgents.supervisorAgent as any,
		masterReviewer: reviewAgents.reviewAgent as any,

		// GEO specialists
		geoOrchestrator: geoOrchestratorAgent as any,
		contentClusterSpecialist: contentClusterAgent as any,
		brandMonitor: brandMonitorAgent as any,
		topicalDepthAnalyzer: topicalDepthAgent as any,
		promptSimulator: promptSimulatorAgent as any,
		staticRenderSpecialist: staticRenderAgent as any,
		aiCopywriter: aiCopywriterAgent as any,
		promptTrendAnalyst: promptTrendAgent as any,
		aiReadinessEvaluator: aiReadinessAgent as any,
	},
	workflows: {
		geoAnalysisWorkflow: geoAnalysisWorkflow as any,
	},
	// memory: networkMemory,
});

/**
 * Development Agent Network
 *
 * A specialized network for software development and technical tasks.
 */
export const developmentAgentNetwork = new NewAgentNetwork({
	id: "development-agent-network",
	name: "Development Agent Network",
	instructions: `
		You are a specialized coordinator for software development and technical tasks.
		
		This network specializes in:
		- Code writing and analysis
		- Technical architecture review
		- Quality assurance and testing
		- Performance optimization
		
		**Available Specialists:**
		- Code Writer: Software development and code analysis
		- Technical Review Agent: Technical validation and architecture review
		- Quality Assurance: Testing and quality standards enforcement
		
		For development tasks, ensure proper planning, implementation, and review cycles.
	`,
	model: getModel("qwen"),
	agents: {
		// Hierarchical agents
		masterPlanner: planningAgents.plannerAgent as any,
		masterSupervisor: supervisorAgents.supervisorAgent as any,
		technicalReviewer: reviewAgents.technicalReviewAgent as any,
		qualityAssurance: reviewAgents.qualityAssuranceAgent as any,

		// Development specialists
		codeWriter: codeWriterAgent as any,
		qaInspector: qaAgent as any,
	},
	workflows: {
		// Add development-specific workflows here when created
	},
	// memory: networkMemory,
});

// Export all networks
export const agentNetworks = {
	hierarchical: hierarchicalAgentNetwork,
	geo: geoAgentNetwork,
	development: developmentAgentNetwork,
};

// Default network
export default hierarchicalAgentNetwork;
