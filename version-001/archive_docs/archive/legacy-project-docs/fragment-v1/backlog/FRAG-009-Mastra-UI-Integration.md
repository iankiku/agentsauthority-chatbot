# FRAG-009 â€“ Mastra UI Integration ðŸš§

_Created: 2025-07-05_ _Status: **PENDING**_

---

## ðŸŽ¯ OBJECTIVE

Integrate the **Mastra backend** (`apps/agents-mastra`) into the **Fragment**
front-end so that workflows and tool calls stream directly into the existing
**Generative Block UI**.

**Success =** A user can open Fragment, trigger `geoAnalysisWorkflow`, and watch
real-time widgets render via the Block Engine using data returned from Mastra.

---

## ðŸ”‘ KEY TASKS

1. **Mastra Client SDK (Fragment)**
   - Location: `apps/fragment/lib/mastra-client.ts`
   - Provide `startWorkflow`, `streamRun`, `callTool` helpers (see Technical
     Design Â§7.2).
2. **Next.js API Proxy Routes**
   - Create `/app/api/mastra/*` in Fragment that proxy to the Mastra app (allows
     local dev with separate ports).
   - Ensure CORS / cookies handled.
3. **Block Engine Wiring**
   - Extend `apps/fragment/components/block-engine/block-engine.tsx` to accept
     **RunEvent** stream and push into store.
   - Map `widget` payloads to `ReactGridLayout` renderer.
4. **Generative UI Demo Page**
   - New route: `/dashboard/mastra-demo` that:
     1. Presents simple form (businessName, url, industry).
     2. Calls `startWorkflow("geoAnalysisWorkflow")`.
     3. Streams results into Block UI.
5. **E2E Cypress Test**
   - Assert that widgets appear within 60s of starting workflow.
   - Snapshot layout for visual diff.

---

## âœ… ACCEPTANCE CRITERIA

- [ ] User sees live widgets (Chart.js rendered inside React Grid Layout)
      generated by Mastra.
- [ ] SSE stream remains open; no console errors.
- [ ] No references to deprecated `@/agents` or `@/ai` remain in Fragment code.
- [ ] Cypress test passes in CI.

---

## ðŸ•’ ESTIMATE

**3 dev-days** (includes E2E test + demo page polish)

---

**Owner:** _TBD_
