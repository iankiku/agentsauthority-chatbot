# FRAG-004 ‚Äì Actionable Recommendations Engine (NO PAYMENTS) üöß

_Created: 2025-01-19_ _Status: **Phase 1 - Same-Day Sprint**_

---

## üéØ CLEAR PROMPT

**Build an agent-powered recommendations system that uses a `RecommendAgent`
from the PIPER-5 protocol to generate specific, prioritized action items from
business analysis facts.**

The `RecommendAgent` should analyze the facts gathered by previous agents
(Probe, Ingest, Parse, Evaluate) and emit actionable recommendations as
structured facts. No separate recommendations API is needed; recommendations are
a direct output of the agent pipeline.

**This ticket has no payment integration.** The focus is exclusively on
generating and displaying high-quality, actionable recommendations to the user.

---

## üéØ EXECUTIVE SUMMARY

**THE CHALLENGE**: We have real data from the `research-service`. Data alone is
interesting, but actionable insights are what users will value and retain for.

**THE SOLUTION**: Build an actionable recommendations engine that shows users
exactly what to do to improve their business visibility, with estimated impact
and effort, all generated by an intelligent agent.

**THE OUTCOME**: Increase user engagement and demonstrate clear, tangible value
beyond raw data analysis.

---

## üõ†Ô∏è TECHNICAL IMPLEMENTATION

### Phase 1: Recommend Agent Integration (Hours 8-10)

**PIPER-5 Pipeline Enhancement:**

The `runPIPER5` orchestrator in `packages/agents/src/orchestration/agent-bus.ts`
will be appended with a `RecommendAgent`.

```typescript
// packages/agents/src/agents/recommend-agent.ts
import { Agent, AgentContext } from "../orchestration/agent-bus";

export class RecommendAgent implements Agent {
	name = "recommend";

	async execute(context: AgentContext): Promise<AgentContext> {
		const facts = context.facts;
		const geoScoreFact = facts.find((f) => f.type === "geo_score_analysis");
		const businessName = context.businessData.name;

		const recommendPrompt = `
			Based on this business analysis for ${businessName}, generate 3-5 specific, actionable recommendations.
			The current GEO Score is: ${geoScoreFact?.data?.overall_score || "N/A"}.

			Analysis Facts:
			${JSON.stringify(facts, null, 2)}

			For each recommendation, provide:
			- A short, compelling title.
			- A clear description of the action to take.
			- An estimated impact (e.g., "high", "medium", "low").
			- The category (e.g., "Content", "Technical SEO", "Social Media").
			- Specific, actionable steps.

			Return a valid JSON array of recommendation objects.
		`;

		const recommendations = await this.callLLM(recommendPrompt); // Assuming a base agent class with LLM calling capability

		// Emit recommendations as structured facts
		recommendations.forEach((rec: any, index: number) => {
			context.facts.push({
				type: "recommendation",
				data: {
					id: `rec_${index + 1}`,
					title: rec.title,
					description: rec.description,
					actionItems: rec.actionItems,
					impact: rec.impact,
					category: rec.category || "optimization",
				},
				source: "recommend_agent",
				confidence: 0.85, // Confidence in the recommendation quality
			});
		});

		return context;
	}
}
```

### Phase 2: UI Implementation (Hours 10-12)

A new artifact, `RecommendationsCard`, will be created to display the output
from the `RecommendAgent`.

**Component Implementation:**

```tsx
// components/artifacts/recommendations-card.tsx
import {
	Card,
	CardContent,
	CardDescription,
	CardHeader,
	CardTitle,
} from "@/components/ui/card";
import { CheckCircle, Zap } from "lucide-react";

// Assuming data is an array of recommendation facts
export function RecommendationsCard({
	recommendations,
}: {
	recommendations: any[];
}) {
	return (
		<Card className="p-6">
			<CardHeader>
				<CardTitle className="flex items-center gap-2">
					<Zap className="h-5 w-5 text-primary" />
					Actionable Recommendations
				</CardTitle>
				<CardDescription>
					Top actions you can take to improve your business visibility.
				</CardDescription>
			</CardHeader>

			<CardContent className="space-y-4">
				{recommendations.map((rec) => (
					<div key={rec.data.id} className="p-4 border rounded-lg">
						<h3 className="font-bold">{rec.data.title}</h3>
						<p className="text-sm text-muted-foreground">
							{rec.data.description}
						</p>
						<ul className="mt-2 list-disc pl-5">
							{rec.data.actionItems.map((item: string, index: number) => (
								<li key={index} className="text-sm">
									{item}
								</li>
							))}
						</ul>
						<div className="mt-2 flex gap-4 text-xs">
							<span className="font-semibold">Impact: {rec.data.impact}</span>
							<span className="font-semibold">
								Category: {rec.data.category}
							</span>
						</div>
					</div>
				))}
			</CardContent>
		</Card>
	);
}
```

This component will be rendered by the `ArtifactRenderer` when `recommendation`
facts are present in the agent context.

---

## üß™ ACCEPTANCE CRITERIA

- [ ] `RecommendAgent` is added to the `PIPER-5` agent sequence.
- [ ] The agent successfully generates 3-5 specific recommendations from
      analysis facts.
- [ ] Recommendations are emitted as structured `recommendation` facts.
- [ ] `RecommendationsCard` artifact renders the recommendations correctly in
      the UI.
- [ ] The UI is clean, easy to understand, and provides clear action items.
- [ ] All mentions of payment, pricing, or revenue activation are removed from
      the user flow related to this feature.

---

## üö¶ RISK MITIGATION

- **Recommendation Quality**: The quality of LLM-generated recommendations can
  vary. The prompt is engineered to be specific, but we must manually review the
  output for the first 20-30 runs to ensure quality.
- **Performance**: The additional LLM call for recommendations will add latency.
  We will monitor the total pipeline execution time to ensure it remains
  acceptable.

---

## üîÑ STATUS UPDATES

**Current Status**: üöß **ACTIVE SPRINT - DEPENDS ON FRAG-003** **Dependencies**:
This ticket requires a working agent pipeline that produces analysis facts from
the `research-service`. **Next Action**: Implement the `RecommendAgent` and
integrate it into the `agent-bus`. **Success Definition**: Users receive
valuable, actionable recommendations that are directly related to the analysis
of their business, enhancing their engagement and the value of the platform.
